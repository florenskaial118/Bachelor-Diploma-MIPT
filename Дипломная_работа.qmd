---
title: "Сравнение генов патогенности (вирулентности) в метагеномах изолятов кишечной микробиоты у здоровых людей и больных клинической депрессией (бакалаврская работа)"
author: 
  - "Студент: Флоренская Лидия Кирилловна"
  - "Научный руководитель: Беккер Ольга Борисовна, канд. биол. наук"
date: 2025-06-20
format: 
  html:
    #code-fold: true
    toc: true
    toc_float: true
    #embed-resources: true
editor: visual
engine: knitr
---

# Материалы и методы

## Дизайн исследования

### Схема исследования

Общий план метагеномного анализа, проведенного в рамках данного исследования, представлен на @fig-pipeline. Этапы подготовки образцов, фильтрации данных и сборки метагеномных ридов в контиги, выполненные в предшествующем исследовании нашей лаборатории "Изменения состава и нейрометаболического профиля кишечной микробиоты человека при большом депрессивном расстройстве" 2022 года \[17\], обозначены зеленым цветом. Голубым цветом обозначены этапы обработки данных, которые были реализованы непосредственно в данной работе. Синим цветом выделены методы статистического сравнения, примененные на различных этапах нашего анализа.

![Схема проведения метагеномного анализа](/Users/lidaflorenskaya/Documents/Work/R/Diploma/PIPELINE%20DIPLOMA.png){#fig-pipeline}

### Формирование когорт

Ключевым аспектом изучения микробиоты пациентов с БДР является ее сравнение с микробиотой лиц, не страдающих данным заболеванием. В рамках предшествующей работы, выполненной в нашей лаборатории \[17\], был реализован следующий протокол отбора пациентов для формирования сравнительных групп.

В группу пациентов с депрессией (группа PD) были включены лица, проходившие стационарное лечение в ГБУЗ «ПКБ № 1 ДЗМ», у которых были диагностированы депрессивные расстройства средней или высокой степени тяжести (коды F31.3, F31.4, F31.5, F32.1, F32.2, F32.3, F32.8, F32.9, F33.1, F33.2 и F33.3 по ICD-10). Предварительно, все потенциальные участники проходили скрининг с использованием шкалы генерализованного тревожного расстройства GAD-7 и опросника депрессивности CES-D. Затем квалифицированный врач-психиатр проводил оценку состояния пациентов по шкале Гамильтона для оценки депрессии (HAMD-17). Окончательное решение о включении пациента в группу PD принималось психиатром на основании следующих критериев:

-   HAMD-17 ≥ 14
-   CES-D ≥ 27
-   GAD-7 \< 10

Соблюдение данных критериев было направлено на обеспечение гомогенности выборки. Важно отметить, что образцы фекалий для исследования собирались **до начала какого-либо медикаментозного лечения**.

Формирование контрольной группы здоровых добровольцев (HC) осуществлялось на основании следующих критериев исключения:

-   Отсутствие диагностированных психиатрических заболеваний.
-   CES-D \< 18
-   GAD-7 \< 5
-   Отсутствие приема антибиотиков, пробиотиков или пребиотиков в течение трех месяцев до момента сбора образцов фекалий.

Применение указанных критериев позволило обеспечить соответствие диагноза депрессии у пациентов группы PD и исключить влияние лекарственных препаратов на состав микробиоты, что необходимо для корректной оценки взаимосвязи между депрессией и составом микробиоты.

**В результате, итоговые когорты включали 38 здоровых добровольцев и 36 пациентов с депрессией**.

## Подготовка и фильтрация метагеномных ридов

Первоначально, в рамках предшествующего исследования, из каждого образца фекалий была выделена общая геномная ДНК с использованием набора QIAamp PowerFecal Pro DNA Kit (Qiagen, Германия) в соответствии с рекомендациями производителя. Далее были созданы метагеномные библиотеки с использованием подхода "shotgun-sequencing". Данный подход включал случайное фрагментирование ДНК до средней длины 350 пар оснований с использованием Covaris M220 (Covaris LLC., США), секвенирование парных прочтений (paired-end reads) на платформе Illumina HiSeq X Ten (Illumina Inc., США) и последующий контроль качества с использованием FastQC v0.11.5 .

Для обеспечения высокого качества данных, исключения влияния артефактов секвенирования и контаминации ДНК хозяина, была выполнена строгая фильтрация ридов. В первую очередь, был произведен тримминг ридов с использованием Trimmomatic v0.39 с целью удаления низкокачественных участков и адаптеров. Затем, для удаления ридов, происходящих от ДНК человека, было проведено выравнивание ридов на референсный геном человека (hg19) с использованием Bowtie2 (версия 2.4.17). Риды, не картирующиеся на геном человека, были сохранены для дальнейшего анализа, что позволило сфокусироваться исключительно на микробном сообществе.

На заключительном этапе подготовки данных, риды были собраны в более длинные контиги с использованием metaSPADes v3.14.1, что позволило повысить точность идентификации генов в последующем анализе. И в них были идентифицированы ORF с помощью MetaGeneMark и сохранены в формате fasta.

Таким образом была сформирована коллекция метагеномных данных, включающая в себя образцы фекалий, полученные от пациентов с депрессией (группа PD) и здоровых добровольцев (группа HC).

## Функциональный анализ метагеномов

Определение и количественная оценка встречаемости и представленности генов патогенности в метагеномных данных с целью выявления потенциальных различий между группами образцов.

-   Поиск генов патогенности:

    -   Выравнивание ORF на базу данных [VFDB](https://www.mgc.ac.cn/VFs/main.htm) (версия *modified_VFDB_setB_full_pro*) с использованием BLASTp (версия *ncbi-blast-2.16.0+*). Критерии: прогент гомологии *“pident”* \>= 90%, разница в длине выровненных последовательностей \<= 5%.

-   Оценка встречаемости найденных генов патогенности:

    -   Выравнивание прочтений на контиги с использованием BWA-MEM.

    -   Подсчет прочтений, выровненных на ORF генов патогенности, с помощью SAMtools indxstats.

-   Таксономическая аннотация контигов:

    -   Классификация контигов с использованием Kraken2 и базы данных pluspf. Пороговое значение уверенности классификатора *--confidence*: 0.01.

-   Нормализация числа прочтений для генов в отобранных сигнатурных парах «патоген – ген»

    -   TMM-нормализация количества прочтений для сигнатурных пар "патоген – ген" с использованием пакета edgeR.

-   Сравнительный статистический анализ представленности генов патогенности:

    -   Тест Фишера (частота встречаемости генов)

    -   Тест Манна-Уитни (количественная представленность генов) с использованием функций *exact*\_*fisher* и chi2_contingency пакета *scipy.stats*.

    -   FDR-коррекция P-value (*multipletests*, *method='fdr_bh',* *statsmodels*.*stats*.*multitest*).

## Таксономический анализ

Определение таксономического состава микробиоты и выявление различий между группами образцов.

-   Таксономическая классификация: комплекс программ Kraken2 (пороговое значение уверенности классификатора *--confidence 0.01)*, KrakenTools (*extract*\_*kraken*\_*reads*.*py*, CZ ID Pathogen List v0.2.1 ) и Bracken (*est*\_*abundance*.*py*)

-   Визуализация: Pavian, fantaxtic.

-   Характеристика разнообразия микробиоты:

    -   Альфа-разнообразие: индекс Шеннона (vegan, R).
    -   Бета-разнообразие: метрика Брея-Кертиса (vegdist, R).
    -   Визуализация бета-разнообразия: NMDS (metaMDS, R).

-   Сравнительный  таксономический статистический анализ на разных уровнях (тесты Манна-Уитни и Фишера) с FDR-коррекцией

    -   Патогенные виды: тест Манна-Уитни, FDR 0.1.

    -   Штаммы патогенных видов: тест Манна-Уитни, FDR 0.1.

    -   Штаммы *E. coli*: тесты Фишера и Манна-Уитни, FDR 0.1.

# Код

## Функциональный анализ метагеномов

## Поиск генов патогенности

1.  Скачать BLAST с [официального сайта](https://ftp.ncbi.nlm.nih.gov/blast/executables/blast+)

2.  Создать BLAST базу данных из [скаченного](https://www.mgc.ac.cn/VFs/download.htm) фаста-файла c аминокислотными последовательностями

```{bash}
head -5 VFDB-database/VFDB_setA_pro.fas
```

```{bash}
Software/ncbi-blast-2.16.0+/bin/makeblastdb \
    -in VFDB-database/VFDB_setA_pro.fas \
    -dbtype 'prot' \
    -out VFDB-database/VFDB_setA_pro/VFDB_setA_pro
```

3.  Найти открытые рамки считывания в собранных контигах MetaGeneMark
4.  Выравнивание ОРС на базу данных [VFDB](https://www.mgc.ac.cn/VFs/main.htm) (версия *VFDB_setA_pro*) с использованием BLASTp (версия *ncbi-blast-2.16.0+*).

```{bash}
#| eval: false
for file in Obtained-data/ORFs/AA/*_orf_aa_names.fasta; do

    filename="${file##*/}"  # Get the filename without the path

    # Use a regex to extract the components
    [[ "$filename" =~ ([A-Za-z]+)_([0-9]+)_orf_aa_names\.fasta ]]
    prefix="${BASH_REMATCH[1]}"
    number="${BASH_REMATCH[2]}"

    # Construct the output filename.
    output_file="Blast-results/Blast-results-raw/raw_blast_file_${prefix}_${number}.csv"

    echo "Processing: $file"

    Software/ncbi-blast-2.16.0+/bin/blastp \
        -query "$file" \
        -db VFDB-database/VFDB_setA_pro/VFDB_setA_pro \
        -out "$output_file" \
        -outfmt 6 \
        -num_threads 4 

done

echo "Script finished."
```

Выполяем эту долгую ячейку с помощью отдельной сессии: `bash screen -S BLAST`; `bash sh Scripts/BLAST.sh`; `bash screen -r BLAST`

Критерии: прогент гомологии *“pident”* \>= 90%, разница в длине выровненных последовательностей \<= 5%.

Таксономическая аннтотация контигов

```{bash}
#| eval: false
CONTIGS_DIR="/mnt/storage/kovtunas/Depression_data/assemblies"
KRAKEN_OUTPUT_DIR="/home/lidaf/1_part/Kraken/Kraken_outputs"
KRAKEN_REPORT_DIR="/home/lidaf/1_part/Kraken/Kraken_reports"
KRAKEN_MPA_REPORT_DIR="/home/lidaf/1_part/Kraken/Kraken_mpa_reports"

for file_path in "$CONTIGS_DIR"/*\.fasta; do
    filename=$(basename "$file_path")
    type=$(echo "$filename" | cut -d'.' -f1 | tr '[:lower:]' '[:upper:]')
    kraken_output_file="$KRAKEN_OUTPUT_DIR/${type}.Kraken_output.txt"
    kraken_report_file="$KRAKEN_REPORT_DIR/${type}.Kraken_report.txt"
    /home/galanova/kraken2/KRAKEN2/kraken2 \
        --db /home/kovtunas/kraken2_pluspf \
        --threads 20 \
        --confidence 0.01 \
        --output "$kraken_output_file" \
        --report "$kraken_report_file"  \
        "$file_path"
    python '/home/lidaf/KrakenTools/kreport2mpa.py' -r "$file_path" -o "$kraken_mpa_report_file" 
    printf "%s\n" "$type"
done
echo "Script finished."
```
